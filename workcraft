#!/usr/bin/env bash

# Remember the current working directory
CURRENT_DIR=`pwd -P`

# Change to Workcraft home directory and put it into the WORKCRAFT_HOME variable
cd `dirname "$0"`
WORKCRAFT_HOME=`pwd -P`
TOOLS_DIR=$WORKCRAFT_HOME/tools
PETRIFY_DIR=$TOOLS_DIR/petrify
PUNF_DIR=$TOOLS_DIR/punf
MPSAT_DIR=$TOOLS_DIR/mpsat
PCOMP_DIR=$TOOLS_DIR/pcomp
SCENCO_DIR=$TOOLS_DIR/scenco
ESPRESSO_DIR=$TOOLS_DIR/espresso
PGMINER_DIR=$TOOLS_DIR/pgminer
VXM_DIR=$TOOLS_DIR/vxm

# Add location of the third-party tools to the PATH variable
export PATH=$PETRIFY_DIR:$PUNF_DIR:$MPSAT_DIR:$PCOMP_DIR:$SCENCO_DIR:$ESPRESSO_DIR:$PGMINER_DIR:$VXM_DIR:$PATH

# Set the JVM executable in JAVA_BIN variable (if not defined yet)
if [ -z "$JAVA_BIN" ]
then
    if [ -z "$JAVA_HOME" ]
    then
        JAVA_BIN=java
    else
        if [ -e "$JAVA_HOME"/bin/java ]
        then
            JAVA_BIN="$JAVA_HOME"/bin/java
        else
            JAVA_BIN="$JAVA_HOME"/java
        fi
    fi
fi

# Add all the plugins and third-party JARs to the CLASSPATH variable 
CLASSPATH=\
"$WORKCRAFT_HOME/CircuitPlugin/bin:"\
"$WORKCRAFT_HOME/CpogsPlugin/bin:"\
"$WORKCRAFT_HOME/DfsPlugin/bin:"\
"$WORKCRAFT_HOME/FsmPlugin/bin:"\
"$WORKCRAFT_HOME/FstPlugin/bin:"\
"$WORKCRAFT_HOME/GraphPlugin/bin:"\
"$WORKCRAFT_HOME/MpsatSynthesisPlugin/bin:"\
"$WORKCRAFT_HOME/MpsatVerificationPlugin/bin:"\
"$WORKCRAFT_HOME/PcompPlugin/bin:"\
"$WORKCRAFT_HOME/PetriNetPlugin/bin:"\
"$WORKCRAFT_HOME/PetrifyPlugin/bin:"\
"$WORKCRAFT_HOME/PolicyNetPlugin/bin:"\
"$WORKCRAFT_HOME/PunfPlugin/bin:"\
"$WORKCRAFT_HOME/SONPlugin/bin:"\
"$WORKCRAFT_HOME/STGPlugin/bin:"\
"$WORKCRAFT_HOME/ThirdParty:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-anim.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-awt-util.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-bridge.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-codec.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-css.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-dom.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-ext.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-extension.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-gui-util.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-gvt.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-parser.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-script.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-svg-dom.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-svggen.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-swing.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-transcoder.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-util.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/batik-xml.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/xml-apis-ext.jar:"\
"$WORKCRAFT_HOME/ThirdParty/batik/xml-apis.jar:"\
"$WORKCRAFT_HOME/ThirdParty/commons-logging-1.1.3.jar:"\
"$WORKCRAFT_HOME/ThirdParty/flexdock-0.5.1.jar:"\
"$WORKCRAFT_HOME/ThirdParty/jackson-core-asl-1.8.10.jar:"\
"$WORKCRAFT_HOME/ThirdParty/jackson-mapper-asl-1.8.10.jar:"\
"$WORKCRAFT_HOME/ThirdParty/javaparser-1.0.7.jar:"\
"$WORKCRAFT_HOME/ThirdParty/jedit.jar:"\
"$WORKCRAFT_HOME/ThirdParty/jbpt-0.2.429.jar:"\
"$WORKCRAFT_HOME/ThirdParty/jga-0.8-lgpl.jar:"\
"$WORKCRAFT_HOME/ThirdParty/js.jar:"\
"$WORKCRAFT_HOME/ThirdParty/junit-4.5.jar:"\
"$WORKCRAFT_HOME/ThirdParty/log4j-1.2.8.jar:"\
"$WORKCRAFT_HOME/ThirdParty/log4j.properties:"\
"$WORKCRAFT_HOME/ThirdParty/pcollections-1.0.0.jar:"\
"$WORKCRAFT_HOME/ThirdParty/substance.jar:"\
"$WORKCRAFT_HOME/ThirdParty/TableLayout-bin-jdk1.5-2009-08-26.jar:"\
"$WORKCRAFT_HOME/WorkcraftCore/bin:"\
"$WORKCRAFT_HOME/XmasPlugin/bin:"\

# Run Workcraft with the specific JAVA_BIN and CLASSPATH
"$JAVA_BIN" -classpath "$CLASSPATH" org.workcraft.Console -dir:"$CURRENT_DIR" "$@"

# Restore the current working directory
cd "$CURRENT_DIR"
